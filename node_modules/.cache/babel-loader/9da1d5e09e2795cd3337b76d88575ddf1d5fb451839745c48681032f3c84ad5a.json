{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\BCEndterm\\\\src\\\\pages\\\\strawsoll.jsx\",\n  _s = $RefreshSig$();\nimport { useCallback, useState, useEffect } from 'react';\nimport { useWallet } from '@solana/wallet-adapter-react';\nimport { Program } from '@project-serum/anchor';\nimport { programId, getProvider } from '../config/web3';\nimport { Redirect, useParams } from 'react-router-dom';\nimport idl from '../idl.json';\nimport Spinner from '../components/spinner';\nimport { PublicKey } from '@solana/web3.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction PollOption({\n  id,\n  label,\n  votes,\n  total,\n  voted,\n  vote\n}) {\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: () => !voted && vote(id),\n    className: \"bg-white items-center flex relative w-[500px] h-20 text-lg p-4 rounded-xl outline-none border-2 border-indigo-500\",\n    style: {\n      cursor: voted ? 'default' : 'pointer'\n    },\n    children: [voted && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-full absolute rounded-[9px] top-0 left-0 bg-indigo-300\",\n      style: {\n        width: `${votes / total * 500 - 4}px`\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 18,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"relative font-semibold max-w-[70%] truncate\",\n      children: label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 7\n    }, this), voted && /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"absolute top-[50%] right-5 -translate-y-1/2 text-slate-800 font-medium\",\n      children: [votes, \" votes \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 28,\n        columnNumber: 25\n      }, this), votes / total * 100, \"%\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 12,\n    columnNumber: 5\n  }, this);\n}\n_c = PollOption;\nfunction Strawsoll() {\n  _s();\n  const [poll, setPoll] = useState(null);\n  const [voted, setVoted] = useState(false);\n  const {\n    strawsollId\n  } = useParams();\n  const wallet = useWallet();\n  const subscribe = useCallback(async () => {\n    const provider = await getProvider(wallet);\n    const program = new Program(idl, programId, provider);\n    const pollPubKey = new PublicKey(strawsollId);\n    const emitter = program.account.poll.subscribe(pollPubKey);\n    emitter.on('change', data => setPoll(data.options.filter(option => !!option)));\n    const state = await program.account.poll.fetch(pollPubKey);\n    setVoted(state.voters.find(voter => voter.toString() === provider.wallet.publicKey.toString()));\n    setPoll(state.options.filter(option => !!option));\n  }, [strawsollId, wallet]);\n  useEffect(() => {\n    if (strawsollId && wallet.connected) {\n      subscribe();\n    }\n  }, [subscribe, strawsollId, wallet]);\n  async function vote(id) {\n    console.log(id);\n    const provider = await getProvider(wallet);\n    const program = new Program(idl, programId, provider);\n    const pollPubKey = new PublicKey(strawsollId);\n    try {\n      await program.methods.vote(id).accounts({\n        poll: pollPubKey,\n        voter: provider.wallet.publicKey\n      }).rpc();\n      setVoted(true);\n    } catch (error) {\n      console.log(error.error.errorCode.code);\n    }\n  }\n  if (!wallet.connected && !wallet.connecting) {\n    return /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col items-center justify-start gap-4 w-full min-h-screen p-4 pt-20\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-10 flex flex-col gap-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-5xl text-white font-bold text-center\",\n        children: \"Your time to vote!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this), voted && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-lg text-center text-slate-100 font-bold\",\n        children: \"Only one vote allowed per wallet.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), poll ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid grid-cols-3 gap-4 w-full\",\n      children: poll.map(option => /*#__PURE__*/_jsxDEV(PollOption, {\n        ...option,\n        total: poll.reduce((prev, curr) => prev + curr.votes, 0),\n        voted: voted,\n        vote: vote\n      }, option.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n_s(Strawsoll, \"IkTGGhvZWDBZ/wYiLohVy1JmTHQ=\", false, function () {\n  return [useParams, useWallet];\n});\n_c2 = Strawsoll;\nexport default Strawsoll;\nvar _c, _c2;\n$RefreshReg$(_c, \"PollOption\");\n$RefreshReg$(_c2, \"Strawsoll\");","map":{"version":3,"names":["useCallback","useState","useEffect","useWallet","Program","programId","getProvider","Redirect","useParams","idl","Spinner","PublicKey","jsxDEV","_jsxDEV","PollOption","id","label","votes","total","voted","vote","onClick","className","style","cursor","children","width","fileName","_jsxFileName","lineNumber","columnNumber","_c","Strawsoll","_s","poll","setPoll","setVoted","strawsollId","wallet","subscribe","provider","program","pollPubKey","emitter","account","on","data","options","filter","option","state","fetch","voters","find","voter","toString","publicKey","connected","console","log","methods","accounts","rpc","error","errorCode","code","connecting","to","map","reduce","prev","curr","_c2","$RefreshReg$"],"sources":["C:/Users/user/Desktop/BCEndterm/src/pages/strawsoll.jsx"],"sourcesContent":["import { useCallback, useState, useEffect } from 'react';\r\nimport { useWallet } from '@solana/wallet-adapter-react';\r\nimport { Program } from '@project-serum/anchor';\r\nimport { programId, getProvider } from '../config/web3';\r\nimport { Redirect, useParams } from 'react-router-dom';\r\nimport idl from '../idl.json';\r\nimport Spinner from '../components/spinner';\r\nimport { PublicKey } from '@solana/web3.js';\r\n\r\nfunction PollOption({ id, label, votes, total, voted, vote }) {\r\n  return (\r\n    <button\r\n      onClick={() => !voted && vote(id)}\r\n      className=\"bg-white items-center flex relative w-[500px] h-20 text-lg p-4 rounded-xl outline-none border-2 border-indigo-500\"\r\n      style={{ cursor: voted ? 'default' : 'pointer' }}\r\n    >\r\n      {voted && (\r\n        <div\r\n          className=\"h-full absolute rounded-[9px] top-0 left-0 bg-indigo-300\"\r\n          style={{\r\n            width: `${(votes / total * 500) - 4}px`\r\n          }}\r\n        />\r\n      )}\r\n      <span className=\"relative font-semibold max-w-[70%] truncate\">{label}</span>\r\n      {voted && (\r\n        <span className=\"absolute top-[50%] right-5 -translate-y-1/2 text-slate-800 font-medium\">\r\n          {votes} votes <br />\r\n          {votes / total * 100}%\r\n        </span>\r\n      )}\r\n    </button>\r\n  );\r\n}\r\n\r\nfunction Strawsoll() {\r\n  const [poll, setPoll] = useState(null);\r\n  const [voted, setVoted] = useState(false);\r\n  const { strawsollId } = useParams();\r\n  const wallet = useWallet();\r\n\r\n  const subscribe = useCallback(async () => {\r\n    const provider = await getProvider(wallet);\r\n    const program = new Program(idl, programId, provider);\r\n\r\n    const pollPubKey = new PublicKey(strawsollId);\r\n\r\n    const emitter = program.account.poll.subscribe(pollPubKey);\r\n    emitter.on('change', (data) => setPoll(data.options.filter(option => !!option)));\r\n\r\n    const state = await program.account.poll.fetch(pollPubKey);\r\n\r\n    setVoted(state.voters.find(voter => voter.toString() === provider.wallet.publicKey.toString()));\r\n    setPoll(state.options.filter(option => !!option));\r\n  }, [strawsollId, wallet]);\r\n\r\n  useEffect(() => {\r\n    if (strawsollId && wallet.connected) {\r\n      subscribe();\r\n    }\r\n  }, [subscribe, strawsollId, wallet]);\r\n\r\n  async function vote(id) {\r\n    console.log(id);\r\n    const provider = await getProvider(wallet);\r\n    const program = new Program(idl, programId, provider);\r\n\r\n    const pollPubKey = new PublicKey(strawsollId);\r\n\r\n    try {\r\n      await program.methods\r\n        .vote(id)\r\n        .accounts({\r\n          poll: pollPubKey,\r\n          voter: provider.wallet.publicKey,\r\n        })\r\n        .rpc();\r\n\r\n      setVoted(true);\r\n    } catch (error) {\r\n      console.log(error.error.errorCode.code);\r\n    }\r\n  }\r\n\r\n  if (!wallet.connected && !wallet.connecting) {\r\n    return <Redirect to=\"/\" />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-start gap-4 w-full min-h-screen p-4 pt-20\">\r\n      <div className=\"mb-10 flex flex-col gap-3\">\r\n        <h1 className=\"text-5xl text-white font-bold text-center\">Your time to vote!</h1>\r\n        {voted && (\r\n          <p className=\"text-lg text-center text-slate-100 font-bold\">\r\n            Only one vote allowed per wallet.\r\n          </p>\r\n        )}\r\n      </div>\r\n      {poll ? (\r\n        <div className=\"grid grid-cols-3 gap-4 w-full\">\r\n          {poll.map(option => (\r\n            <PollOption\r\n              key={option.id}\r\n              {...option}\r\n              total={poll.reduce((prev, curr) => prev + curr.votes, 0)}\r\n              voted={voted}\r\n              vote={vote}\r\n            />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <Spinner />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Strawsoll;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}